<!DOCTYPE html>
<!--
==============================================================================
memory.html - ãƒ¡ãƒ¢ãƒªç®¡ç†ãƒšãƒ¼ã‚¸
==============================================================================

ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã€‘
è¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ã‚’ç¢ºèªãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒšãƒ¼ã‚¸ã§ã™ã€‚
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰ã®ä¸€è¦§è¡¨ç¤ºãƒ»è¿½åŠ ãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- ç›®æ¨™ã®ä¸€è¦§è¡¨ç¤ºãƒ»è¿½åŠ ãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- ä¼šè©±å±¥æ­´ã®ä¸€è¦§è¡¨ç¤ºãƒ»å‰Šé™¤

ã€HTMLã®åŸºæœ¬æ§‹é€ ã€‘
<!DOCTYPE html>  - HTML5æ–‡æ›¸ã§ã‚ã‚‹ã“ã¨ã‚’å®£è¨€
<html>           - HTMLæ–‡æ›¸ã®ãƒ«ãƒ¼ãƒˆè¦ç´ 
<head>           - ãƒ¡ã‚¿æƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€CSSã€è¨­å®šãªã©ï¼‰
<body>           - å®Ÿéš›ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„

ã€å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã€‘
1. CSS: ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ï¼ˆè¦‹ãŸç›®ã‚’æ•´ãˆã‚‹ï¼‰
2. JavaScript: å‹•çš„ãªå‹•ä½œã‚’å®Ÿç¾
3. Fetch API: ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡
4. DOMæ“ä½œ: HTMLè¦ç´ ã®è¿½åŠ ãƒ»å‰Šé™¤ãƒ»å¤‰æ›´
==============================================================================
-->
<html lang="ja">
<head>
    <!-- æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’UTF-8ã«è¨­å®šï¼ˆæ—¥æœ¬èªã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹ãŸã‚ï¼‰ -->
    <meta charset="UTF-8">

    <!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç”¨ã®è¨­å®šï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ« -->
    <title>Memory Assistant - ãƒ¡ãƒ¢ãƒªç®¡ç†</title>

    <!--
    ========================================
    CSSã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
    ========================================

    ã€CSSã®åŸºæœ¬ã€‘
    ã‚»ãƒ¬ã‚¯ã‚¿ { ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£: å€¤; }

    ä¾‹:
    .button { background: blue; }
    â†’ class="button" ã®è¦ç´ ã®èƒŒæ™¯ã‚’é’ã«ã™ã‚‹
    -->
    <style>
        /*
        ====================
        ãƒªã‚»ãƒƒãƒˆCSS
        ====================
        ãƒ–ãƒ©ã‚¦ã‚¶ã”ã¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ã‚’ãªãã™
        */
        * {
            margin: 0;           /* å¤–å´ã®ä½™ç™½ã‚’0ã« */
            padding: 0;          /* å†…å´ã®ä½™ç™½ã‚’0ã« */
            box-sizing: border-box;  /* paddingã¨borderã‚’å¹…ã«å«ã‚ã‚‹ */
        }

        /*
        ====================
        å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«
        ====================
        */
        body {
            /* ãƒ•ã‚©ãƒ³ãƒˆã®è¨­å®šï¼ˆå·¦ã‹ã‚‰å„ªå…ˆé †ã«è©¦ã™ï¼‰ */
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;

            /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            /* æœ€å°ã®é«˜ã•ã‚’ç”»é¢ã„ã£ã±ã„ã« */
            min-height: 100vh;

            /* å†…å´ã®ä½™ç™½ */
            padding: 20px;
        }

        /*
        ====================
        ã‚³ãƒ³ãƒ†ãƒŠï¼ˆãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼‰
        ====================
        */
        .container {
            max-width: 1200px;      /* æœ€å¤§å¹…ã‚’åˆ¶é™ */
            margin: 0 auto;          /* ä¸­å¤®æƒãˆ */
            background: white;       /* èƒŒæ™¯è‰² */
            border-radius: 20px;     /* è§’ã‚’ä¸¸ã */
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);  /* å½± */
            overflow: hidden;        /* ã¯ã¿å‡ºãŸéƒ¨åˆ†ã‚’éš ã™ */
        }

        /*
        ====================
        ãƒ˜ãƒƒãƒ€ãƒ¼
        ====================
        */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;                      /* ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ãƒœãƒƒã‚¯ã‚¹ */
            justify-content: space-between;     /* å·¦å³ã«åˆ†æ•£ */
            align-items: center;                /* å‚ç›´æ–¹å‘ä¸­å¤®æƒãˆ */
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ */
        .nav-link {
            color: white;
            text-decoration: none;      /* ä¸‹ç·šã‚’æ¶ˆã™ */
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);  /* åŠé€æ˜ã®ç™½ */
            transition: background 0.2s;            /* å¤‰åŒ–ã‚’ãªã‚ã‚‰ã‹ã« */
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /*
        ====================
        çµ±è¨ˆã‚«ãƒ¼ãƒ‰
        ====================
        */
        .stats-container {
            display: grid;                              /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            grid-template-columns: repeat(4, 1fr);      /* 4åˆ—ã«åˆ†å‰² */
            gap: 20px;                                  /* ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ */
            padding: 20px 30px;
            background: #f8fafc;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼šç”»é¢ãŒç‹­ã„å ´åˆã¯2åˆ—ã« */
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
            margin-top: 5px;
        }

        /*
        ====================
        ã‚¿ãƒ–ï¼ˆåˆ‡ã‚Šæ›¿ãˆï¼‰
        ====================
        */
        .tabs {
            display: flex;
            background: #f1f5f9;
            padding: 10px 30px;
            gap: 10px;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;                    /* ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ‰‹ã®å½¢ã« */
            border-radius: 8px;
            font-size: 15px;
            color: #64748b;
            transition: all 0.2s;
        }

        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        /* é¸æŠä¸­ã®ã‚¿ãƒ– */
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /*
        ====================
        ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
        ====================
        */
        .content {
            padding: 30px;
        }

        /* ã‚¿ãƒ–ãƒ‘ãƒãƒ«ï¼ˆéè¡¨ç¤º/è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆï¼‰ */
        .tab-panel {
            display: none;      /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯éè¡¨ç¤º */
        }

        .tab-panel.active {
            display: block;     /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‘ãƒãƒ«ã ã‘è¡¨ç¤º */
        }

        /*
        ====================
        ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼
        ====================
        */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            color: #1e293b;
        }

        /*
        ====================
        ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
        ====================
        */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);        /* ä¸Šã«æµ®ã‹ã›ã‚‹ */
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        /*
        ====================
        ãƒ†ãƒ¼ãƒ–ãƒ«
        ====================
        */
        .table-container {
            overflow-x: auto;       /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
        }

        table {
            width: 100%;
            border-collapse: collapse;  /* ã‚»ãƒ«ã®å¢ƒç•Œã‚’é‡ã­ã‚‹ */
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
        }

        tr:hover {
            background: #f8fafc;
        }

        /* æ“ä½œãƒœã‚¿ãƒ³ã®ã‚»ãƒ« */
        .actions {
            display: flex;
            gap: 8px;
        }

        /*
        ====================
        ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰
        ====================
        */
        .modal {
            display: none;                      /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯éè¡¨ç¤º */
            position: fixed;                    /* ç”»é¢ã«å›ºå®š */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);     /* åŠé€æ˜ã®é»’èƒŒæ™¯ */
            justify-content: center;
            align-items: center;
            z-index: 1000;                      /* æœ€å‰é¢ã«è¡¨ç¤º */
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;                   /* ç”»é¢é«˜ã•ã®90%ã¾ã§ */
            overflow-y: auto;                   /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ */
            animation: modalSlideIn 0.3s ease; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒç¾ã‚Œã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        /* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #94a3b8;
        }

        .close-btn:hover {
            color: #475569;
        }

        /*
        ====================
        ãƒ•ã‚©ãƒ¼ãƒ 
        ====================
        */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;                      /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ ç·šã‚’æ¶ˆã™ */
            border-color: #667eea;              /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®è‰² */
        }

        .form-textarea {
            resize: vertical;                   /* ç¸¦æ–¹å‘ã«ãƒªã‚µã‚¤ã‚ºå¯èƒ½ */
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /*
        ====================
        é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        ====================
        */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: toastSlideIn 0.3s ease;
            z-index: 2000;
        }

        .toast-success {
            background: #22c55e;
        }

        .toast-error {
            background: #ef4444;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /*
        ====================
        ç©ºã®çŠ¶æ…‹è¡¨ç¤º
        ====================
        */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /*
        ====================
        ã‚«ãƒ†ã‚´ãƒªãƒãƒƒã‚¸
        ====================
        */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-personal { background: #dbeafe; color: #1d4ed8; }
        .badge-preference { background: #fef3c7; color: #b45309; }
        .badge-skill { background: #d1fae5; color: #047857; }
        .badge-default { background: #f1f5f9; color: #475569; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
        .badge-active { background: #d1fae5; color: #047857; }
        .badge-completed { background: #dbeafe; color: #1d4ed8; }
        .badge-archived { background: #f1f5f9; color: #475569; }

        /* å„ªå…ˆåº¦ãƒãƒƒã‚¸ */
        .badge-high { background: #fee2e2; color: #dc2626; }
        .badge-medium { background: #fef3c7; color: #b45309; }
        .badge-low { background: #e0e7ff; color: #4338ca; }

        /*
        ====================
        ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
        ====================
        */
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /*
        ====================
        ä¼šè©±è¡¨ç¤º
        ====================
        */
        .conversation-item {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .conversation-time {
            color: #94a3b8;
            font-size: 12px;
        }

        .conversation-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .assistant-message {
            background: white;
            border: 1px solid #e2e8f0;
        }

        .message-label {
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 4px;
            opacity: 0.7;
        }
    </style>
</head>

<body>
    <!--
    ========================================
    HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    ========================================

    ã€HTMLã®æ§‹é€ ã«ã¤ã„ã¦ã€‘
    - <div>: æ±ç”¨çš„ãªã‚³ãƒ³ãƒ†ãƒŠè¦ç´ 
    - classå±æ€§: CSSã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ã™ã‚‹ãŸã‚ã®åå‰
    - idå±æ€§: JavaScriptã§è¦ç´ ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ä¸€æ„ã®åå‰
    -->

    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>Memory Management</h1>
            <a href="/" class="nav-link">ãƒãƒ£ãƒƒãƒˆã«æˆ»ã‚‹</a>
        </div>

        <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ï¼ˆidå±æ€§ã§JavaScriptã‹ã‚‰å€¤ã‚’æ›´æ–°ï¼‰ -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="profileCount">0</div>
                <div class="stat-label">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="goalCount">0</div>
                <div class="stat-label">ç›®æ¨™</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeGoals">0</div>
                <div class="stat-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç›®æ¨™</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="conversationCount">0</div>
                <div class="stat-label">ä¼šè©±å±¥æ­´</div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="tabs">
            <button class="tab active" data-tab="profiles">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
            <button class="tab" data-tab="goals">ç›®æ¨™</button>
            <button class="tab" data-tab="conversations">ä¼šè©±å±¥æ­´</button>
        </div>

        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div class="content">
            <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
            <div id="profiles-panel" class="tab-panel active">
                <div class="section-header">
                    <h2 class="section-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
                    <button class="btn btn-primary" onclick="openProfileModal()">
                        + æ–°è¦è¿½åŠ 
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ã‚­ãƒ¼</th>
                                <th>å€¤</th>
                                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                                <th>æ›´æ–°æ—¥æ™‚</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="profilesTable">
                            <!-- JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
                        </tbody>
                    </table>
                </div>
                <div id="profilesEmpty" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>

            <!-- ç›®æ¨™ãƒ‘ãƒãƒ« -->
            <div id="goals-panel" class="tab-panel">
                <div class="section-header">
                    <h2 class="section-title">ç›®æ¨™ä¸€è¦§</h2>
                    <button class="btn btn-primary" onclick="openGoalModal()">
                        + æ–°è¦è¿½åŠ 
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                                <th>èª¬æ˜</th>
                                <th>å„ªå…ˆåº¦</th>
                                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th>é€²æ—</th>
                                <th>ç· ã‚åˆ‡ã‚Š</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="goalsTable">
                            <!-- JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
                        </tbody>
                    </table>
                </div>
                <div id="goalsEmpty" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">ğŸ¯</div>
                    <p>ç›®æ¨™ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>

            <!-- ä¼šè©±å±¥æ­´ãƒ‘ãƒãƒ« -->
            <div id="conversations-panel" class="tab-panel">
                <div class="section-header">
                    <h2 class="section-title">ä¼šè©±å±¥æ­´</h2>
                </div>
                <div id="conversationsList">
                    <!-- JavaScriptã§å‹•çš„ã«è¿½åŠ  -->
                </div>
                <div id="conversationsEmpty" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">ğŸ’¬</div>
                    <p>ä¼šè©±å±¥æ­´ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="profileModalTitle">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¿½åŠ </h3>
                <button class="close-btn" onclick="closeProfileModal()">&times;</button>
            </div>
            <form id="profileForm" onsubmit="submitProfile(event)">
                <div class="form-group">
                    <label class="form-label">ã‚­ãƒ¼ï¼ˆé …ç›®åï¼‰</label>
                    <input type="text" id="profileKey" class="form-input"
                           placeholder="ä¾‹: name, hobby, skill" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å€¤</label>
                    <input type="text" id="profileValue" class="form-input"
                           placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ, ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
                    <select id="profileCategory" class="form-select">
                        <option value="">æœªåˆ†é¡</option>
                        <option value="personal">å€‹äººæƒ…å ±</option>
                        <option value="preference">å¥½ã¿ãƒ»è¶£å‘³</option>
                        <option value="skill">ã‚¹ã‚­ãƒ«</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeProfileModal()">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç›®æ¨™è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="goalModalTitle">ç›®æ¨™ã‚’è¿½åŠ </h3>
                <button class="close-btn" onclick="closeGoalModal()">&times;</button>
            </div>
            <form id="goalForm" onsubmit="submitGoal(event)">
                <input type="hidden" id="goalId">
                <div class="form-group">
                    <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="goalTitle" class="form-input"
                           placeholder="ä¾‹: Pythonã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹" required>
                </div>
                <div class="form-group">
                    <label class="form-label">èª¬æ˜</label>
                    <textarea id="goalDescription" class="form-textarea"
                              placeholder="ç›®æ¨™ã®è©³ç´°ã‚’å…¥åŠ›..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">å„ªå…ˆåº¦</label>
                    <select id="goalPriority" class="form-select">
                        <option value="">æœªè¨­å®š</option>
                        <option value="low">ä½</option>
                        <option value="medium">ä¸­</option>
                        <option value="high">é«˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <select id="goalStatus" class="form-select">
                        <option value="active">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
                        <option value="completed">å®Œäº†</option>
                        <option value="archived">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">é€²æ—ç‡ (0-100)</label>
                    <input type="number" id="goalProgress" class="form-input"
                           min="0" max="100" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">ç· ã‚åˆ‡ã‚Š</label>
                    <input type="date" id="goalDeadline" class="form-input">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeGoalModal()">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!--
    ========================================
    JavaScript ã‚³ãƒ¼ãƒ‰
    ========================================

    ã€JavaScriptã®åŸºæœ¬ã€‘
    - å¤‰æ•°å®£è¨€: letï¼ˆå†ä»£å…¥å¯ï¼‰, constï¼ˆå†ä»£å…¥ä¸å¯ï¼‰
    - é–¢æ•°å®šç¾©: function åå‰() {} ã¾ãŸã¯ () => {}ï¼ˆã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼‰
    - éåŒæœŸå‡¦ç†: async/awaitï¼ˆã‚µãƒ¼ãƒãƒ¼é€šä¿¡ãªã©ã§ä½¿ç”¨ï¼‰
    - DOMæ“ä½œ: document.getElementById() ãªã©
    -->
    <script>
        // ============================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        // ============================================

        // ç·¨é›†ä¸­ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚­ãƒ¼ï¼ˆæ–°è¦è¿½åŠ æ™‚ã¯nullï¼‰
        let editingProfileKey = null;

        // ç·¨é›†ä¸­ã®ç›®æ¨™IDï¼ˆæ–°è¦è¿½åŠ æ™‚ã¯nullï¼‰
        let editingGoalId = null;

        // ============================================
        // åˆæœŸåŒ–å‡¦ç†
        // ============================================

        /**
         * ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†
         *
         * ã€DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆã€‘
         * HTMLã®è§£æãŒå®Œäº†ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç™ºç«ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã€‚
         * ç”»åƒãªã©ã®ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ã¯å¾…ãŸãªã„ã€‚
         */
        document.addEventListener('DOMContentLoaded', () => {
            // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadStats();
            loadProfiles();
            loadGoals();
            loadConversations();

            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            setupTabs();
        });

        /**
         * ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
         *
         * ã€querySelectorAllã€‘
         * CSSã‚»ãƒ¬ã‚¯ã‚¿ã«ä¸€è‡´ã™ã‚‹ã™ã¹ã¦ã®è¦ç´ ã‚’å–å¾—ã€‚
         *
         * ã€forEachã€‘
         * é…åˆ—ã®å„è¦ç´ ã«å¯¾ã—ã¦é–¢æ•°ã‚’å®Ÿè¡Œã€‚
         *
         * ã€data-å±æ€§ã€‘
         * HTMLè¦ç´ ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æŒãŸã›ã‚‹æ–¹æ³•ã€‚
         * data-tab="profiles" â†’ element.dataset.tab ã§ "profiles" ã‚’å–å¾—
         */
        function setupTabs() {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’å–å¾—
            const tabs = document.querySelectorAll('.tab');

            // å„ã‚¿ãƒ–ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‹ã‚‰ active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    tabs.forEach(t => t.classList.remove('active'));
                    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¿ãƒ–ã« active ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                    tab.classList.add('active');

                    // ã™ã¹ã¦ã®ãƒ‘ãƒãƒ«ã‚’éè¡¨ç¤º
                    document.querySelectorAll('.tab-panel').forEach(panel => {
                        panel.classList.remove('active');
                    });

                    // å¯¾å¿œã™ã‚‹ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
                    const panelId = `${tab.dataset.tab}-panel`;
                    document.getElementById(panelId).classList.add('active');
                });
            });
        }

        // ============================================
        // é€šçŸ¥è¡¨ç¤º
        // ============================================

        /**
         * ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹
         *
         * @param {string} message - è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
         * @param {string} type - é€šçŸ¥ã®ç¨®é¡ ('success' ã¾ãŸã¯ 'error')
         *
         * ã€createElementã€‘
         * æ–°ã—ã„HTMLè¦ç´ ã‚’ä½œæˆã™ã‚‹ã€‚
         *
         * ã€appendChildã€‘
         * è¦ç´ ã‚’è¦ªè¦ç´ ã®å­ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã€‚
         *
         * ã€setTimeoutã€‘
         * æŒ‡å®šãƒŸãƒªç§’å¾Œã«é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
         */
        function showToast(message, type = 'success') {
            // ãƒˆãƒ¼ã‚¹ãƒˆè¦ç´ ã‚’ä½œæˆ
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;

            // bodyã«è¿½åŠ ï¼ˆç”»é¢å³ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
            document.body.appendChild(toast);

            // 3ç§’å¾Œã«è‡ªå‹•ã§å‰Šé™¤
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ============================================
        // çµ±è¨ˆæƒ…å ±
        // ============================================

        /**
         * çµ±è¨ˆæƒ…å ±ã‚’APIã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹
         *
         * ã€async/awaitã€‘
         * éåŒæœŸå‡¦ç†ã‚’åŒæœŸçš„ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿ã€‚
         * await ã¯ Promise ãŒè§£æ±ºã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹ã€‚
         *
         * ã€fetchã€‘
         * ã‚µãƒ¼ãƒãƒ¼ã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹é–¢æ•°ã€‚
         * Promiseã‚’è¿”ã™ã®ã§ã€awaitã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ã†ã€‚
         *
         * ã€response.json()ã€‘
         * ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã€‚
         * ã“ã‚Œã‚‚Promiseã‚’è¿”ã™ã€‚
         */
        async function loadStats() {
            try {
                // APIã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
                const response = await fetch('/api/memory/stats');

                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹
                const stats = await response.json();

                // å„è¦ç´ ã«å€¤ã‚’è¨­å®š
                // textContentã¯è¦ç´ å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š/å–å¾—ã™ã‚‹
                document.getElementById('profileCount').textContent = stats.profile_count;
                document.getElementById('goalCount').textContent = stats.goal_count;
                document.getElementById('activeGoals').textContent = stats.active_goals;
                document.getElementById('conversationCount').textContent = stats.conversation_count;
            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
                console.error('Failed to load stats:', error);
            }
        }

        // ============================================
        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é–¢é€£
        // ============================================

        /**
         * ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§ã‚’APIã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹
         */
        async function loadProfiles() {
            try {
                const response = await fetch('/api/profiles');
                const profiles = await response.json();

                // ãƒ†ãƒ¼ãƒ–ãƒ«ã®tbodyè¦ç´ ã‚’å–å¾—
                const tbody = document.getElementById('profilesTable');
                const emptyState = document.getElementById('profilesEmpty');

                // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒãªã„å ´åˆã¯ç©ºã®çŠ¶æ…‹ã‚’è¡¨ç¤º
                if (profiles.length === 0) {
                    tbody.innerHTML = '';  // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç©ºã«ã™ã‚‹
                    emptyState.style.display = 'block';
                    return;
                }

                // ç©ºã®çŠ¶æ…‹ã‚’éè¡¨ç¤º
                emptyState.style.display = 'none';

                // ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†…å®¹ã‚’ç”Ÿæˆ
                // map: é…åˆ—ã®å„è¦ç´ ã‚’å¤‰æ›ã—ãŸæ–°ã—ã„é…åˆ—ã‚’ä½œæˆ
                // join: é…åˆ—ã‚’æ–‡å­—åˆ—ã«çµåˆ
                tbody.innerHTML = profiles.map(p => `
                    <tr>
                        <td><strong>${escapeHtml(p.key)}</strong></td>
                        <td>${escapeHtml(p.value)}</td>
                        <td>${getCategoryBadge(p.category)}</td>
                        <td>${formatDate(p.updated_at)}</td>
                        <td class="actions">
                            <button class="btn btn-secondary btn-small"
                                    onclick="editProfile('${escapeHtml(p.key)}')">
                                ç·¨é›†
                            </button>
                            <button class="btn btn-danger btn-small"
                                    onclick="deleteProfile('${escapeHtml(p.key)}')">
                                å‰Šé™¤
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load profiles:', error);
                showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
         */
        function openProfileModal() {
            editingProfileKey = null;  // æ–°è¦è¿½åŠ ãƒ¢ãƒ¼ãƒ‰
            document.getElementById('profileModalTitle').textContent = 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¿½åŠ ';
            document.getElementById('profileForm').reset();  // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('profileKey').disabled = false;  // ã‚­ãƒ¼å…¥åŠ›ã‚’æœ‰åŠ¹åŒ–
            document.getElementById('profileModal').classList.add('show');
        }

        /**
         * ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
         *
         * @param {string} key - ç·¨é›†ã™ã‚‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã‚­ãƒ¼
         */
        async function editProfile(key) {
            try {
                // ç¾åœ¨ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¦è©²å½“ã™ã‚‹ã‚‚ã®ã‚’æ¢ã™
                const response = await fetch('/api/profiles');
                const profiles = await response.json();

                // find: æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æœ€åˆã®è¦ç´ ã‚’è¿”ã™
                const profile = profiles.find(p => p.key === key);

                if (!profile) {
                    showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    return;
                }

                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®š
                editingProfileKey = key;
                document.getElementById('profileModalTitle').textContent = 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†';

                // ãƒ•ã‚©ãƒ¼ãƒ ã«ç¾åœ¨ã®å€¤ã‚’è¨­å®š
                document.getElementById('profileKey').value = profile.key;
                document.getElementById('profileKey').disabled = true;  // ã‚­ãƒ¼ã¯å¤‰æ›´ä¸å¯
                document.getElementById('profileValue').value = profile.value;
                document.getElementById('profileCategory').value = profile.category || '';

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
                document.getElementById('profileModal').classList.add('show');
            } catch (error) {
                console.error('Failed to load profile:', error);
                showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
         */
        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('show');
        }

        /**
         * ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹
         *
         * @param {Event} event - ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
         *
         * ã€event.preventDefault()ã€‘
         * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰ã‚’é˜²ãã€‚
         *
         * ã€fetch ã® POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€‘
         * method: HTTPãƒ¡ã‚½ãƒƒãƒ‰
         * headers: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆContent-Typeã§ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’æŒ‡å®šï¼‰
         * body: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼ˆJSON.stringifyã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–‡å­—åˆ—åŒ–ï¼‰
         */
        async function submitProfile(event) {
            event.preventDefault();  // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’é˜²ã

            // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
            const key = document.getElementById('profileKey').value;
            const value = document.getElementById('profileValue').value;
            const category = document.getElementById('profileCategory').value || null;

            try {
                let response;

                if (editingProfileKey) {
                    // æ›´æ–°ï¼ˆPUTï¼‰
                    response = await fetch(`/api/profiles/${encodeURIComponent(editingProfileKey)}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ value, category })
                    });
                } else {
                    // æ–°è¦ä½œæˆï¼ˆPOSTï¼‰
                    response = await fetch('/api/profiles', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ key, value, category })
                    });
                }

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                // æˆåŠŸã—ãŸã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
                closeProfileModal();
                loadProfiles();
                loadStats();
                showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to save profile:', error);
                showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å‰Šé™¤ã™ã‚‹
         *
         * @param {string} key - å‰Šé™¤ã™ã‚‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã‚­ãƒ¼
         *
         * ã€confirmã€‘
         * ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã€‚OKãªã‚‰trueã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãªã‚‰falseã‚’è¿”ã™ã€‚
         */
        async function deleteProfile(key) {
            if (!confirm(`ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€Œ${key}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                return;  // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã¯ä½•ã‚‚ã—ãªã„
            }

            try {
                const response = await fetch(`/api/profiles/${encodeURIComponent(key)}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Delete failed');
                }

                loadProfiles();
                loadStats();
                showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to delete profile:', error);
                showToast('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ============================================
        // ç›®æ¨™é–¢é€£
        // ============================================

        /**
         * ç›®æ¨™ä¸€è¦§ã‚’APIã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹
         */
        async function loadGoals() {
            try {
                const response = await fetch('/api/goals');
                const goals = await response.json();

                const tbody = document.getElementById('goalsTable');
                const emptyState = document.getElementById('goalsEmpty');

                if (goals.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }

                emptyState.style.display = 'none';

                tbody.innerHTML = goals.map(g => `
                    <tr>
                        <td><strong>${escapeHtml(g.title)}</strong></td>
                        <td>${escapeHtml(g.description || '-')}</td>
                        <td>${getPriorityBadge(g.priority)}</td>
                        <td>${getStatusBadge(g.status)}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="progress-bar" style="width: 60px;">
                                    <div class="progress-fill" style="width: ${g.progress}%;"></div>
                                </div>
                                <span style="font-size: 12px;">${g.progress}%</span>
                            </div>
                        </td>
                        <td>${g.deadline ? formatDate(g.deadline) : '-'}</td>
                        <td class="actions">
                            <button class="btn btn-secondary btn-small"
                                    onclick="editGoal(${g.id})">
                                ç·¨é›†
                            </button>
                            <button class="btn btn-danger btn-small"
                                    onclick="deleteGoal(${g.id})">
                                å‰Šé™¤
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load goals:', error);
                showToast('ç›®æ¨™ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ç›®æ¨™è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
         */
        function openGoalModal() {
            editingGoalId = null;
            document.getElementById('goalModalTitle').textContent = 'ç›®æ¨™ã‚’è¿½åŠ ';
            document.getElementById('goalForm').reset();
            document.getElementById('goalProgress').value = 0;
            document.getElementById('goalStatus').value = 'active';
            document.getElementById('goalModal').classList.add('show');
        }

        /**
         * ç›®æ¨™ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
         *
         * @param {number} id - ç·¨é›†ã™ã‚‹ç›®æ¨™ã®ID
         */
        async function editGoal(id) {
            try {
                const response = await fetch(`/api/goals/${id}`);
                const goal = await response.json();

                editingGoalId = id;
                document.getElementById('goalModalTitle').textContent = 'ç›®æ¨™ã‚’ç·¨é›†';

                // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
                document.getElementById('goalId').value = goal.id;
                document.getElementById('goalTitle').value = goal.title;
                document.getElementById('goalDescription').value = goal.description || '';
                document.getElementById('goalPriority').value = goal.priority || '';
                document.getElementById('goalStatus').value = goal.status;
                document.getElementById('goalProgress').value = goal.progress;

                // æ—¥ä»˜ã®å‡¦ç†ï¼ˆAPIã‹ã‚‰ã®æ—¥ä»˜å½¢å¼ã‚’å…¥åŠ›æ¬„ç”¨ã«å¤‰æ›ï¼‰
                if (goal.deadline) {
                    // ISOå½¢å¼ã®æ—¥ä»˜ã‹ã‚‰YYYY-MM-DDéƒ¨åˆ†ã‚’æŠ½å‡º
                    const dateStr = goal.deadline.split('T')[0];
                    document.getElementById('goalDeadline').value = dateStr;
                } else {
                    document.getElementById('goalDeadline').value = '';
                }

                document.getElementById('goalModal').classList.add('show');
            } catch (error) {
                console.error('Failed to load goal:', error);
                showToast('ç›®æ¨™ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ç›®æ¨™ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
         */
        function closeGoalModal() {
            document.getElementById('goalModal').classList.remove('show');
        }

        /**
         * ç›®æ¨™ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹
         *
         * @param {Event} event - ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ
         */
        async function submitGoal(event) {
            event.preventDefault();

            // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
            const title = document.getElementById('goalTitle').value;
            const description = document.getElementById('goalDescription').value || null;
            const priority = document.getElementById('goalPriority').value || null;
            const status = document.getElementById('goalStatus').value;
            const progress = parseInt(document.getElementById('goalProgress').value) || 0;
            const deadlineInput = document.getElementById('goalDeadline').value;

            // æ—¥ä»˜ã‚’ISOå½¢å¼ã«å¤‰æ›ï¼ˆå…¥åŠ›ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
            const deadline = deadlineInput ? `${deadlineInput}T00:00:00` : null;

            // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ä½œæˆ
            const body = { title, description, priority, status, progress, deadline };

            try {
                let response;

                if (editingGoalId) {
                    // æ›´æ–°ï¼ˆPUTï¼‰
                    response = await fetch(`/api/goals/${editingGoalId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                } else {
                    // æ–°è¦ä½œæˆï¼ˆPOSTï¼‰
                    response = await fetch('/api/goals', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                }

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                closeGoalModal();
                loadGoals();
                loadStats();
                showToast('ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to save goal:', error);
                showToast('ç›®æ¨™ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ç›®æ¨™ã‚’å‰Šé™¤ã™ã‚‹
         *
         * @param {number} id - å‰Šé™¤ã™ã‚‹ç›®æ¨™ã®ID
         */
        async function deleteGoal(id) {
            if (!confirm('ã“ã®ç›®æ¨™ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/api/goals/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Delete failed');
                }

                loadGoals();
                loadStats();
                showToast('ç›®æ¨™ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to delete goal:', error);
                showToast('ç›®æ¨™ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ============================================
        // ä¼šè©±å±¥æ­´é–¢é€£
        // ============================================

        /**
         * ä¼šè©±å±¥æ­´ã‚’APIã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹
         */
        async function loadConversations() {
            try {
                const response = await fetch('/api/conversations');
                const conversations = await response.json();

                const container = document.getElementById('conversationsList');
                const emptyState = document.getElementById('conversationsEmpty');

                if (conversations.length === 0) {
                    container.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }

                emptyState.style.display = 'none';

                container.innerHTML = conversations.map(c => `
                    <div class="conversation-item">
                        <div class="conversation-header">
                            <span class="conversation-time">${formatDate(c.timestamp)}</span>
                            <button class="btn btn-danger btn-small"
                                    onclick="deleteConversation(${c.id})">
                                å‰Šé™¤
                            </button>
                        </div>
                        <div class="conversation-message user-message">
                            <div class="message-label">ã‚ãªãŸ</div>
                            ${escapeHtml(c.user_message)}
                        </div>
                        <div class="conversation-message assistant-message">
                            <div class="message-label">ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</div>
                            ${escapeHtml(c.assistant_message)}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load conversations:', error);
                showToast('ä¼šè©±å±¥æ­´ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        /**
         * ä¼šè©±ã‚’å‰Šé™¤ã™ã‚‹
         *
         * @param {number} id - å‰Šé™¤ã™ã‚‹ä¼šè©±ã®ID
         */
        async function deleteConversation(id) {
            if (!confirm('ã“ã®ä¼šè©±ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/api/conversations/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Delete failed');
                }

                loadConversations();
                loadStats();
                showToast('ä¼šè©±ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Failed to delete conversation:', error);
                showToast('ä¼šè©±ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ============================================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        // ============================================

        /**
         * HTMLã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦XSSæ”»æ’ƒã‚’é˜²ã
         *
         * @param {string} text - ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
         * @returns {string} ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
         *
         * ã€XSSæ”»æ’ƒã¨ã¯ï¼Ÿã€‘
         * ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãã®ã¾ã¾è¡¨ç¤ºã™ã‚‹ã¨ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ
         * å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ä¾‹:
         * å…¥åŠ›: <script>alert('æ”»æ’ƒ')</script>
         * ã“ã‚Œã‚’é˜²ããŸã‚ã€< > ãªã©ã‚’ &lt; &gt; ã«å¤‰æ›ã™ã‚‹ã€‚
         */
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;  // textContentã¯è‡ªå‹•çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹
            return div.innerHTML;
        }

        /**
         * æ—¥ä»˜ã‚’èª­ã¿ã‚„ã™ã„å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹
         *
         * @param {string} dateStr - ISOå½¢å¼ã®æ—¥ä»˜æ–‡å­—åˆ—
         * @returns {string} ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸæ—¥ä»˜
         *
         * ã€toLocaleStringã€‘
         * æ—¥ä»˜ã‚’åœ°åŸŸã«åˆã‚ã›ãŸå½¢å¼ã§æ–‡å­—åˆ—åŒ–ã™ã‚‹ã€‚
         * 'ja-JP' ã§æ—¥æœ¬ã®å½¢å¼ã«ãªã‚‹ã€‚
         */
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        /**
         * ã‚«ãƒ†ã‚´ãƒªã«å¯¾å¿œã™ã‚‹ãƒãƒƒã‚¸HTMLã‚’è¿”ã™
         *
         * @param {string} category - ã‚«ãƒ†ã‚´ãƒªå
         * @returns {string} ãƒãƒƒã‚¸ã®HTML
         *
         * ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã€‘
         * ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆï¼ˆ`ï¼‰ã§å›²ã‚€ã¨ã€${å¤‰æ•°}ã§å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚ã‚‹ã€‚
         * è¤‡æ•°è¡Œã®æ–‡å­—åˆ—ã‚‚æ›¸ã‘ã‚‹ã€‚
         */
        function getCategoryBadge(category) {
            const labels = {
                personal: 'å€‹äººæƒ…å ±',
                preference: 'å¥½ã¿',
                skill: 'ã‚¹ã‚­ãƒ«'
            };
            const className = category ? `badge-${category}` : 'badge-default';
            const label = labels[category] || category || 'æœªåˆ†é¡';
            return `<span class="badge ${className}">${label}</span>`;
        }

        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒãƒƒã‚¸HTMLã‚’è¿”ã™
         *
         * @param {string} status - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å
         * @returns {string} ãƒãƒƒã‚¸ã®HTML
         */
        function getStatusBadge(status) {
            const labels = {
                active: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–',
                completed: 'å®Œäº†',
                archived: 'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–'
            };
            return `<span class="badge badge-${status}">${labels[status] || status}</span>`;
        }

        /**
         * å„ªå…ˆåº¦ã«å¯¾å¿œã™ã‚‹ãƒãƒƒã‚¸HTMLã‚’è¿”ã™
         *
         * @param {string} priority - å„ªå…ˆåº¦
         * @returns {string} ãƒãƒƒã‚¸ã®HTML
         */
        function getPriorityBadge(priority) {
            if (!priority) return '-';
            const labels = {
                low: 'ä½',
                medium: 'ä¸­',
                high: 'é«˜'
            };
            return `<span class="badge badge-${priority}">${labels[priority] || priority}</span>`;
        }
    </script>
</body>
</html>
